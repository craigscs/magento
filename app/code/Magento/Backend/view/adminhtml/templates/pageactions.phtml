<?php
/**
 * Copyright Â© 2013-2017 Magento, Inc. All rights reserved.
 * See COPYING.txt for license details.
 */

// @codingStandardsIgnoreFile

?>
<?php if ($block->getChildHtml()):?>
    <div data-mage-init='{"floatingHeader": {}}' class="page-actions" <?php /* @escapeNotVerified */ echo $block->getUiId('content-header') ?>>
        <?php echo $block->getChildHtml(); ?>
        </div>
<?php endif; ?>


<div id="copy_from_div" style="display:none;">
    <div id="searchContainer" style="padding:10px;">
        <div class="admin__action-multiselect-search-wrap" style="width:400px; display:inline-block">
            <b>Search for an item</b>
            <select id="highlight_search">
            </select>
            <label class="admin__action-multiselect-search-label"></label>
        </div>
        <br>
        <b>Choose fields to copy</b>
        <br>
        <select multiple style="display: inline-block; max-height:250px; overflow:auto;" id="copy_items">
            <option value="name">Name</option>
            <option value="categories">Categories</option>
            <option value="highlights">Highlights</option>
            <option value="techspecs">Specifications</option>
            <option value="description">Description</option>
            <option value="InTheBox">Includes</option>
            <option value="features">Features</option>
            <option value="images">Images & Videos</option>
            <option value="seo">Seo Information</option>
            <option value="related">Related Products</option>
            <option value="accessories">Accessories</option>
            <option value="compatibility">Compatibility</option>
            <option values="downloads">Downloadable Files</option>
        </select>
        <button type="button" class="action-secondary" onclick="runCopy()" style="display:inline-block; float:right; margin-top:10px;">Copy fields</button>
        <br>
        <div id="copy_messages"></div>
    </div>
</div>
<style>
    .copy_success {
        color:#00aa00;
    }
</style>
<script>
    function openCopyModal()
    {
        jQuery('#copy_from_div').modal();
        jQuery('#copy_from_div').modal("openModal");
    }

    function runCopy()
    {
        var fields = jQuery('#copy_items').val();
        var item = jQuery('#highlight_search').val();
        if (item == "") {
            alert("Please choose an item to copy from!");
            return;
        }
        jQuery('#copy_items').val().each(function (i, obj) {
            jQuery.ajax({
                url: 'http://'+window.location.hostname+"/admin/catalog/product/copy/id/"+item+"/field/"+i+"/",
                data: {form_key: window.FORM_KEY},
                context: document.body
            }).done(function(res) {
                if (!res.res.isArray) {
                    copyfield(res.field, res.res);
                } else {
                    copyfields(n, v);
                }
            })
        });
    }

    function copyfield(n, v)
    {
        jQuery('[name="product['+n+']"]').val(v);
    }

    function setFields(vals)
    {
        jQuery.each(vals, function (i, v) {
            jQuery('#product_form_'+i).html(v);
            jQuery('#product_form_'+i).val(v);
        });
    }

    function copyitem(id, mfr)
    {
        jQuery('#searchPicked').val(id);
        jQuery('#picked_mfr').html(mfr);
    }
</script>