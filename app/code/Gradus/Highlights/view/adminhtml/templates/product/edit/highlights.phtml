<?php
$tech = $this->getProduct()->getData('highlights');
$info = json_decode($tech, true);
$count = 1;
?>
<div id="highlight_container2">
    <table class="admin__dynamic-rows data-grid">
        <thead>
        <tr>
            <th class="data-grid-draggable-row-cell"></th>
            <th class="data-grid-th position" style="width:75px"><span>Position</span></th>
            <th class="data-grid-th"><span>Highlight Text</span></th>
            <th style="width:100px"/>
        </tr>
        </thead>
    <?php foreach ($info as $i) : ?>
        <tr>
            <td class=""data-grid-draggable-row-cell">
            <div class="draggable-handle3"></div>
            </td>
            <td class="posrow">
                <?= $count ?>
            </td>
            <td>
                <input style="width:100%" value="<?= $i ?>" />
            </td>
            <td>Remove</td>
        </tr>
        <?php $count++ ?>
    <?php endforeach; ?>
        </table>
</div>

<div id="highlight_container">
    <?php if (count($info) > 0) : ?>
        <?php foreach ($info as $i) : ?>
            <?php if (!is_null($i)) : ?>
                <div style="margin:auto" class="gradus_fields" id="highlight_<?= $count ?>">
                    <div class="draggable-handle highlight_drag"><b><?= $count ?></b></div>
                    <label class="gradus_label" for="highlight_<?= $count ?>">Highlight</label>
                    <input data-form-part="product_form" name=highlights[<?= $count ?>]" style="width:75%" class="gradus_text_large" id="hightlight_<?= $count ?>" value="<?= $i ?>" />
                    <a src="javascript:void(0)" onclick="deleteHighlight('highlight_<?= $count ?>')">
                        <img style="width:20px;" src="<?= $this->getViewFileUrl('Gradus_Catalog::images/trash.png') ?>">
                    </a>
                </div>
                <?php $count++ ?>
    <?php endif ?>
    <?php endforeach ?>
<?php endif ?>
</div>

<button class="action-secondary" style="margin-right:5px;" onclick="addHighlight()">Add Highlight</button>
<div class="select_pad">
<select class="search_select" id="copy_from_highlights">
    <option value="-1">SKU | Name</option>
    <?php foreach ($this->getProducts() as $p) : ?>
        <option value="<?= $p->getId() ?>"><?= $p->getSku() ?> | <?= $p->getName() ?></option>
    <?php endforeach; ?>
</select>
    <button class="action-secondary" onclick="copyhighlight()">Copy from</button>
    </div>


<div id="demo">
    <button style="margin-right:15px; display:inline-block" onclick="adddiv('25%')">25%</button>
    <button style="margin-right:15px; display:inline-block" onclick="adddiv('50%')">50%</button>
    <button style="margin-right:15px; display:inline-block" onclick="adddiv('75%')">75%</button>
    <button style="margin-right:15px; display:inline-block" onclick="adddiv('100%')">100%</button>
    Enter Your Label into these input fields
    <div style="clear: both" />
</div>

<script>
    var $q = jQuery.noConflict();


    function adddiv(per)
    {
        console.log(per);
        var inp = "<input style='border:2px solid; width:"+per+"' />";
        console.log(inp);
        $q('#demo').append(inp);
    }



    function copyhighlight()
    {
        var theid = $q('#copy_from_highlights').val();
        $q.ajax({
            url: 'http://'+window.location.hostname+"/admin/catalog/product/copy/id/"+theid+"/field/highlights/",
            data: {form_key: window.FORM_KEY},
            context: document.body
        }).done(function(res) {
            var q = res.res;
            $q('#highlight_container').html(q);
        });
    }

    $q( document ).ready(function() {
        $q('#copy_from_highlights').chosen();
        $q('#highlight_container').sortable({
            handle: '.draggable-handle',
            revert: 300,
            placeholder: "jqplaceholder",
            tolerance: "intersect",
            update: function( event, ui ) {
                $q('.highlight_drag').each(function(i, obj) {
                    var ii = i+1;
                   $q(this).html(ii);
                })
            }
        }).disableSelection();

        $q('#highlight_container2 > table > tbody').sortable({
            handle: '.draggable-handle3',
            revert: 300,
            placeholder: "jqplaceholder",
            tolerance: "intersect",
            update: function( event, ui ) {
                $q('.highlight_drag').each(function(i, obj) {
                    var ii = i+1;
                    $q(this).html(ii);
                })
                $q('.posrow').each(function(i, obj) {
                    var ii = i+1;
                    $q(this).html(ii);
                })
            }
        }).disableSelection();

    });
    function addHighlight()
    {
        var counts = $q('#highlight_container input').length;
        var clb = counts+1;
        var q = '';
        q += '<div style="margin:auto" class="gradus_fields" id="highlight_'+clb+'">';
        q += '<div class="draggable-handle highlight_drag"><b>'+clb+'</b></div>';
        q += '<label class="gradus_label" for="highlight_'+clb+'">Highlight</label>';
        q += '<input data-form-part="product_form" name="highlights['+clb+']" style="margin-left:6px; width:75%;" class="gradus_text_large" id="hightlight_'+clb+'" value="" />';
        q += ' <a src="javascript:void(0)" onclick="deleteHighlight(\'highlight_'+clb+'\')">';
        q += '<img style="width:20px;" src="<?= $this->getViewFileUrl("Gradus_Catalog::images/trash.png") ?>"></a></div>';
        $q('#highlight_container').append
        (q);
    }

    function deleteHighlight(h)
    {
        $q('#'+h).remove();
        $q('.highlight_drag').each(function(i, obj) {
            var ii = i+1;
            $q(this).html(ii);
        });
    }
</script>